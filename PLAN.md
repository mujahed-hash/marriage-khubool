# Marriage Project – Development Plan

> **Deep analysis of backend needs for frontend, frontend features to develop, and integration gaps.**

---
*** Note in routes we should never expose user's real ID we will always use Cutome Unique ID Generated by backend for each object this will be used for routes and params and whatsoever reasons.

## 1. Current State Summary

### Backend (Node.js + Express + MongoDB)

| Endpoint | Method | Auth | Status |
|----------|--------|------|--------|
| `/api/health` | GET | No | ✅ Working |
| `/api/auth/register` | POST | No | ✅ Working |
| `/api/auth/login` | POST | No | ✅ Working |
| `/api/auth/me` | GET | Yes | ✅ Exists, not used by frontend |
| `/api/users/me` | GET | Yes | ✅ Exists, not used by frontend |
| `/api/profiles` | POST/PUT | Yes | ✅ Working |
| `/api/profiles/me` | GET | Yes | ✅ Working |
| `/api/profiles/sample` | GET | No | ✅ Working |
| `/api/profiles/list` | GET | No | ✅ Working |
| `/api/profiles/:id` | GET | No | ✅ Working |

**Models:** User, Profile  
**Backend runs on:** PORT from `.env` (default 5006)

### Frontend (Angular)

| Component | Route | Backend Used | Status |
|-----------|-------|--------------|--------|
| Home | `/` | getProfiles (diamond, gold) | ✅ Integrated |
| Login | `/login` | auth/login | ✅ Integrated |
| Register | `/register` | auth/register | ✅ Integrated |
| Dashboard | `/dashboard` | profiles/me | ✅ Integrated |
| User Profile | `/profile/:id` | profiles/:id | ✅ Integrated |
| Profile Wizard | `/create-profile` | profiles/me, profiles, profiles/sample | ✅ Integrated |
| Search | `/search` | profiles/list?search | ✅ Integrated |
| Profile List | `/profiles/:tier` | profiles/list?tier | ✅ Integrated |
| Membership | `/membership` | None | ⚠️ UI only |
| Settings | `/settings` | None | ❌ Placeholder |
| Profile Visitors | `/profile-visitors` | None | ❌ Placeholder |
| My Photos | `/my-photos` | None | ⚠️ Cropper UI only, no API |
| Right Sidebar | (layout) | getProfiles | ✅ Integrated |
| Navbar | (layout) | Search→/search | ✅ Integrated |
| Sidebar | (layout) | AuthService.logout | ✅ Integrated |

---

## 2. Backend Needs for Frontend

### 2.1 Features with NO Backend (Must Build)

| Feature | Backend Needed | Priority |
|---------|----------------|----------|
| **Profile Visitors** | `GET /api/profiles/me/visitors`, `POST /api/profiles/:id/view` | High |
| **Shortlist** | `POST /api/shortlist`, `GET /api/shortlist`, `DELETE /api/shortlist/:id` | High |
| **Send Interest** | `POST /api/interest/:profileId`, `GET /api/interest/sent`, `GET /api/interest/received` | High |
| **Report Profile** | `POST /api/reports` | Medium |
| **Photo Upload** | `POST /api/profiles/me/photos` or `POST /api/upload` | High |
| **Delete Profile** | `DELETE /api/profiles/me` | Medium |
| **User Settings** | `GET /api/users/me/settings`, `PUT /api/users/me/settings` | Medium |
| **Chat/Messaging** | WebSocket or REST (messages, conversations) | Low (complex) |
| **Membership/Payment** | Stripe/Razorpay integration | Low (complex) |
| **Requirements** | Extend Profile model with partner preferences | Medium |

### 2.2 Backend Models to Add

```
ProfileVisitor: { viewerId, profileId, viewedAt }
Shortlist:      { userId, profileId, createdAt }
Interest:       { fromUserId, toProfileId, status, createdAt }
Report:         { reporterId, reportedProfileId, reason, createdAt }
Photo:          { profileId, url, order, isPrimary }
Settings:       { userId, notifications, privacy, ... }
```

### 2.3 Backend Endpoints to Add (Detailed)

| Endpoint | Method | Auth | Body/Params | Returns |
|----------|--------|------|-------------|---------|
| `/api/profiles/me/visitors` | GET | Yes | - | `{ visitors: [...] }` |
| `/api/profiles/:id/view` | POST | Yes | - | Record view, return ok |
| `/api/shortlist` | GET | Yes | - | `{ profiles: [...] }` |
| `/api/shortlist` | POST | Yes | `{ profileId }` | Add to shortlist |
| `/api/shortlist/:profileId` | DELETE | Yes | - | Remove from shortlist |
| `/api/interest/:profileId` | POST | Yes | - | Send interest |
| `/api/interest/sent` | GET | Yes | - | `{ interests: [...] }` |
| `/api/interest/received` | GET | Yes | - | `{ interests: [...] }` |
| `/api/reports` | POST | Yes | `{ profileId, reason }` | Create report |
| `/api/profiles/me/photos` | GET | Yes | - | `{ photos: [...] }` |
| `/api/profiles/me/photos` | POST | Yes | multipart | Upload photo |
| `/api/profiles/me` | DELETE | Yes | - | Delete own profile |
| `/api/users/me/settings` | GET | Yes | - | User settings |
| `/api/users/me/settings` | PUT | Yes | `{ ... }` | Update settings |

---

## 3. Frontend Features to Develop

### 3.1 Quick Fixes (No New Backend)

| Item | Location | Fix |
|------|----------|-----|
| Sidebar Logout | `sidebar.html` | Change `routerLink="/login"` to `(click)="logout()"` + inject AuthService |
| Right Sidebar | `right-sidebar` | Fetch `getProfiles({ limit: 3 })` and render dynamically |
| Navbar Search | `navbar.html` | Wire form to navigate `/search?q=...` or inline search |
| Profile Visitors Count | Sidebar/Navbar | Fetch count from API when backend ready |

### 3.2 Features Needing Backend First

| Feature | Frontend Work | Backend Dependency |
|---------|---------------|---------------------|
| Profile Visitors | List component, API service | `GET /profiles/me/visitors` |
| Shortlisted Profiles | List page, add/remove actions | Shortlist API |
| Send Interest | Button handler, list of sent | Interest API |
| Report | Modal + submit | Report API |
| My Photos | Upload, crop, save to API | Photo upload API |
| Delete Profile | Confirmation modal + API call | `DELETE /profiles/me` |
| Settings | Form + API | Settings API |
| Chat | Messages UI | Chat/WebSocket API |
| Membership | Payment form | Payment gateway |

### 3.3 Incomplete Integrations

| Item | Current | Target |
|------|---------|--------|
| Profile list pagination | None | Use `page`, `limit` from API |
| Search filters | Text only | Add state, gender dropdowns |
| Profile photo | Base64 in JSON | File upload to storage |
| PUT for profile update | Only POST used | Use PUT when profile exists |
| Session refresh | None | Use `GET /auth/me` on app init |

---

## 4. Recommended Development Order

### Phase 1: Quick Wins ✅ COMPLETED

1. ~~**Sidebar logout**~~ – Call `AuthService.logout()` before navigate
2. ~~**Right sidebar**~~ – Fetch suggested profiles from `getProfiles`
3. ~~**Navbar search**~~ – Wire to `/search` with query param
4. ~~**Delete profile**~~ – Backend `DELETE /profiles/me` + frontend confirmation modal

### Phase 2: Core Features (3–5 days)

5. **Photo upload** – Backend upload endpoint + storage (local/S3), My Photos integration
6. **Profile list pagination** – Add page/limit to API calls, pagination UI
7. **Search filters** – Add state, gender, tier filters to search page
8. **Shortlist** – Backend model + API, Dashboard "Shortlisted Profiles" link to list

### Phase 3: Engagement (5–7 days)

9. **Profile visitors** – Backend model + API, ProfileVisitorComponent list
10. **Send Interest** – Backend model + API, wire buttons on UserProfile
11. **Report** – Backend model + API, Report button modal

### Phase 4: Advanced (1–2 weeks)

12. **Settings** – Backend settings model, SettingsComponent form
13. **Chat** – WebSocket or REST, messaging UI (complex)
14. **Membership/Payment** – Razorpay/Stripe, upgrade flow
15. **Requirements** – Partner preference fields in Profile, "View Requirements" modal

---

## 5. Agent Work Split (Cursor vs Antigravity)

> **Purpose:** Split work equally between two agents. Same plan structure, same number of items. Each agent owns full-stack for their assigned features. Coordinate via this plan.

### Cursor – Assigned Work ✅ COMPLETED

| # | Feature | Backend | Frontend | Status |
|---|---------|---------|----------|--------|
| 1 | **Photo upload** | Photo model, `GET/POST /api/profiles/me/photos`, multer + storage | My Photos: wire upload/crop to API | ✅ Done |
| 2 | **Profile list pagination** | Extend `/profiles/list` with `page`, `limit`, `total`, `pages` | Pagination UI on profile-list | ✅ Done |
| 3 | **Search filters** | Extend `/profiles/list` with `state`, `gender` params | State, gender dropdowns on search page | ✅ Done |
| 4 | **Session refresh** | Use existing `GET /api/auth/me` | Call on app init, restore user | ✅ Done |
| 5 | **PUT for profile update** | Already exists | Use PUT when profile exists in wizard | ✅ Done |

---

### Antigravity – Assigned Work ✅ COMPLETED

| # | Feature | Backend | Frontend | Status |
|---|---------|---------|----------|--------|
| 1 | **Shortlist** | Shortlist model, `GET/POST/DELETE /api/shortlist` | Shortlist page, add/remove, Dashboard link | ✅ Done |
| 2 | **Profile visitors** | ProfileVisitor model, `GET /profiles/me/visitors`, `POST /profiles/:id/view` | ProfileVisitorComponent list | ✅ Done |
| 3 | **Send Interest** | Interest model, `POST /api/interest/:id`, `GET /api/interest/sent|received` | Buttons on UserProfile, Interests page | ✅ Done |
| 4 | **Report** | Report model, `POST /api/reports` | Report modal, button on UserProfile | ✅ Done |
| 5 | **Settings** | Settings model, `GET/PUT /api/settings` | SettingsComponent form | ✅ Done |

---

### Phase 5: Remaining Work (Equal Split)

**Cursor – Remaining (3 items) ✅ COMPLETED**

| # | Feature | Backend | Frontend | Status |
|---|---------|---------|----------|--------|
| 1 | **User Profile: Photos, Biodata buttons** | None | Wire buttons: Photos → scroll, Biodata → scroll to section | ✅ Done |
| 2 | **Register: Terms & Privacy** | None | Add routes `/terms`, `/privacy` with content, link from register | ✅ Done |
| 3 | **Layout/UX polish** | None | overflow-x: hidden, legal pages responsive, theme bg | ✅ Done |

**Antigravity – Remaining (3 items) ✅ COMPLETED**

| # | Feature | Backend | Frontend | Status |
|---|---------|---------|----------|-|
| 1 | **Profile visitors count** | Use existing `GET /profiles/me/visitors` | Sidebar + Navbar: fetch count, show dynamic number | ✅ Done |
| 2 | **Partner requirements** | Extend Profile model with partner preference fields | Dashboard "View Requirements" modal, Profile wizard fields | ✅ Done |
| 3 | **User Profile: Requirements button** | Needs requirements in Profile | Wire button to show requirements modal | ✅ Done |

---

### Coordination Rules (Remaining Work)

1. **Profile visitors count** – Antigravity only. Uses `VisitorService.getMyVisitors()`, add count to `sidebar`, `navbar`.
2. **User Profile buttons** – Cursor: Photos, Biodata. Antigravity: Requirements (after partner preferences backend).
3. **Partner requirements** – Antigravity only. Backend: extend Profile schema. Frontend: wizard + modal.
4. **Register Terms & Privacy** – Cursor only. Add `/terms`, `/privacy` routes or external links.

---

## 6. Detailed Checklist

### Backend

- [x] `DELETE /api/profiles/me` – Delete own profile ✅
- [x] ProfileVisitor model + `GET /profiles/me/visitors`, `POST /profiles/:id/view` (Antigravity) ✅
- [x] Shortlist model + CRUD endpoints (Antigravity) ✅
- [x] Interest model + send/list endpoints (Antigravity) ✅
- [x] Report model + `POST /api/reports` (Antigravity) ✅
- [x] Photo model + upload endpoint (multer + local/S3) (Cursor) ✅
- [x] Settings model + GET/PUT `/api/settings` (Antigravity) ✅
- [x] Partner requirements fields in Profile (Antigravity) ✅
- [ ] Chat/messaging (optional, complex)
- [ ] Payment integration (optional, complex)

### Frontend

- [x] Sidebar: logout calls AuthService.logout() ✅
- [x] Right sidebar: fetch and display real profile suggestions ✅
- [x] Navbar: search form navigates to /search or triggers search ✅
- [x] Dashboard: "Shortlisted Profiles" → new route `/shortlist` (Antigravity) ✅
- [x] Dashboard: "Delete Profile" → confirmation + API ✅
- [x] Dashboard: "View Requirements" → modal (Antigravity) ✅
- [x] User Profile: wire Photos (Cursor), Requirements (Antigravity), Biodata (Cursor) buttons ✅
- [x] User Profile: wire Send Interest, Shortlist, Chat, Report (Antigravity) ✅
- [x] Profile list: pagination UI (Cursor) ✅
- [x] Search: state, gender filters (Cursor) ✅
- [x] Profile visitors: list + API (Antigravity) ✅
- [x] My Photos: upload + API integration (Cursor) ✅
- [x] Settings: form + API (Antigravity) ✅
- [x] Register: Terms & Privacy pages (Cursor) ✅
- [x] Use `GET /api/auth/me` for session restore on app load (Cursor) ✅
- [ ] Chat messaging UI (optional, complex)
- [ ] Membership Payment flow (optional, complex)

### Integration

- [x] Use `PUT /api/profiles` for profile updates (when profile exists) ✅
- [x] Add `state`, `gender` to search API params from UI ✅
- [x] Add `page`, `limit` to profile list API calls ✅
- [x] Profile visitors count in sidebar/navbar (Antigravity) ✅

---

### Phase 6: New Features (Equal Split)

**Antigravity – Assigned (4 items)**

| # | Feature | Backend | Frontend | Status |
|---|---------|---------|----------|--------|
| 1 | **Accept/Reject Interest** | `PUT /api/interest/:id/accept\|reject` | Accept/Reject buttons on received interests, status badges | |
| 2 | **Block Profile** | Block model + `POST/DELETE/GET /api/block` | Block button on UserProfile | |
| 3 | **Profile Deactivation** | `isActive` field + activate/deactivate endpoints | Toggle in Settings | |
| 4 | **Real-time Chat** | Conversation/Message models, Socket.io setup, chat routes | Chat component with conversation list + messages | |

**Cursor – Assigned (3 items)**

| # | Feature | Backend | Frontend | Status |
|---|---------|---------|----------|--------|
| 5 | **Notifications System** | Notification model + routes, WebSocket events | Bell icon dropdown, notifications page | |
| 6 | **Match Score Algorithm** | Match % endpoint comparing partnerPreferences | Match badge on profile cards | |
| 7 | **Membership & Payment** | Razorpay integration, order model | Payment page, upgrade flow | |

#### Coordination Rules (Phase 6)

1. **WebSocket**: Antigravity sets up Socket.io in `index.js`. Cursor hooks into it for notifications.
2. **Antigravity owns**: interest routes, block routes, chat routes, profile deactivation.
3. **Cursor owns**: notification routes, match routes, membership/payment routes.
4. **Shared files**: `index.js`, `app.routes.ts`, `sidebar.html` — each agent adds their own entries only.

---

## 7. Environment Notes

- **Frontend API URL:** `http://localhost:5006/api` (in `environment.ts`)
- **Backend PORT:** Set in `.env` as `PORT=5006`
- **MongoDB:** `MONGODB_URI` in `.env`
- **JWT:** `JWT_SECRET` required in `.env`

---

## 8. File Reference

| Purpose | Path |
|---------|------|
| Backend entry | `backend/src/index.js` |
| Auth routes | `backend/src/routes/auth.js` |
| Profile routes | `backend/src/routes/profiles.js` |
| User routes | `backend/src/routes/users.js` |
| Frontend routes | `frontend/src/app/app.routes.ts` |
| API service | `frontend/src/app/services/api.service.ts` |
| Auth service | `frontend/src/app/services/auth.ts` |
| Profile service | `frontend/src/app/services/profile.ts` |
| Environment | `frontend/src/environments/environment.ts` |
