import{a as u,b as p}from"./chunk-DQJ6WRPO.js";import{a,n as c,q as f,x as l}from"./chunk-AY3CH6AK.js";function h(r){return!r||r.startsWith("http")?r:`${u.uploadsBaseUrl}${r}`}var s="khubool_profile_draft",g=class r{constructor(e){this.api=e;let t=localStorage.getItem(s);t&&this.currentProfile.set(JSON.parse(t))}currentProfile=l({});currentStep=l(1);get profile(){return this.currentProfile.asReadonly()}get step(){return this.currentStep.asReadonly()}setProfile(e){this.currentProfile.set(a({},e)),localStorage.setItem(s,JSON.stringify(e))}updateProfile(e){let t=a(a({},this.currentProfile()),e);this.currentProfile.set(t),localStorage.setItem(s,JSON.stringify(t))}nextStep(){this.currentStep()<7&&this.currentStep.set(this.currentStep()+1)}prevStep(){this.currentStep()>1&&this.currentStep.set(this.currentStep()-1)}setStep(e){e>=1&&e<=7&&this.currentStep.set(e)}async fetchMyProfile(){try{let e=await this.api.get("/profiles/me");return e.profilePhotoUrl&&(e.profilePhotoUrl=h(e.profilePhotoUrl)),this.currentProfile.set(e),e}catch{return null}}async saveProfile(){try{let e=this.currentProfile(),t=this.toApiPayload(e),i=!!(e._id||e.profileId)?await this.api.put("/profiles",t):await this.api.post("/profiles",t);return i.profilePhotoUrl&&(i.profilePhotoUrl=h(i.profilePhotoUrl)),this.currentProfile.set(i),localStorage.removeItem(s),!0}catch{return!1}}async getProfileById(e){try{return await this.api.get(`/profiles/${e}`)}catch{return null}}getProfileIdForApi(e,t){let o=e?._id??e?.profileId??t??null;return o!=null?String(o):null}async getProfileActions(e){try{return await this.api.get(`/profiles/${e}/actions`)}catch{return{shortlisted:!1,interestSent:!1,blocked:!1}}}async getSampleProfile(){try{return await this.api.get("/profiles/sample")}catch{return{}}}async deleteProfile(){try{return await this.api.delete("/profiles/me"),this.currentProfile.set({}),localStorage.removeItem(s),!0}catch{return!1}}async getProfiles(e){let t={};return e?.tier&&(t.tier=e.tier),e?.search&&(t.search=e.search),e?.state&&(t.state=e.state),e?.gender&&(t.gender=e.gender),e?.page&&(t.page=String(e.page)),e?.limit&&(t.limit=String(e.limit)),this.api.get("/profiles/list",Object.keys(t).length?t:void 0)}async getPhotos(){try{return(await this.api.get("/profiles/me/photos")).photos||[]}catch{return[]}}async uploadPhoto(e,t=!1){try{let o=new FormData;o.append("photo",e);let i=t?"/profiles/me/photos?primary=true":"/profiles/me/photos";return await this.api.upload(i,o)}catch{return null}}async setPrimaryPhoto(e){try{return await this.api.put(`/profiles/me/photos/${e}/primary`,{}),await this.fetchMyProfile(),!0}catch{return!1}}async deletePhoto(e){try{return await this.api.delete(`/profiles/me/photos/${e}`),await this.fetchMyProfile(),!0}catch{return!1}}toApiPayload(e){let t={};return["fullName","gender","dateOfBirth","height","motherTongue","maritalStatus","religion","caste","gothra","manglik","country","state","district","city","locality","pinCode","nativePlace","highestEducation","degree","occupation","company","monthlyIncome","placeOfOccupation","fatherStatus","motherStatus","siblings","familyType","familyValues","diet","smoking","drinking","hobbies","bio","profilePhotoUrl","verificationDocUrl","membershipTier","visitDarghaFateha","complexion","email","contactNo","alternateNo","fatherName","fatherOccupation","motherName","motherOccupation","partnerPreferences"].forEach(i=>{let n=e[i];n!=null&&n!==""&&(t[i]=n)}),t}static \u0275fac=function(t){return new(t||r)(f(p))};static \u0275prov=c({token:r,factory:r.\u0275fac,providedIn:"root"})};export{g as a};
