import{$b as U,Ca as M,Cb as I,Eb as L,La as b,Ma as S,Nb as T,Oa as P,Ob as N,Pa as A,Qa as C,R as x,Ra as n,Rb as k,S as h,Sa as i,Ub as z,Vb as F,Wb as V,Xa as y,Za as c,_a as g,_b as W,aa as p,cb as o,db as m,eb as E,fb as w,gb as u,hb as f,ib as _,kb as D,mb as O,pa as l,xa as v}from"./chunk-RU7WV6XK.js";var R=(r,t)=>t._id;function j(r,t){r&1&&(n(0,"div",20),o(1,"Loading audit log..."),i())}function J(r,t){if(r&1&&(n(0,"tr")(1,"td")(2,"div",26)(3,"div",27),o(4),i(),n(5,"div")(6,"div",28),o(7),i(),n(8,"div",29),o(9),i()()()(),n(10,"td")(11,"span",30),o(12),i()(),n(13,"td"),o(14),i(),n(15,"td",31),o(16),i(),n(17,"td",32),o(18),D(19,"date"),i()()),r&2){let e=t.$implicit,a=g(2);l(4),m((e.adminId==null||e.adminId.fullName==null?null:e.adminId.fullName.charAt(0))||"?"),l(3),m((e.adminId==null?null:e.adminId.fullName)||"\u2014"),l(2),m(e.adminId==null?null:e.adminId.email),l(3),m(e.action),l(2),m(e.resource),l(2),m(a.formatDetails(e.details)),l(2),m(O(19,7,e.createdAt,"medium"))}}function q(r,t){r&1&&(n(0,"tr")(1,"td",33),o(2,"No audit entries found."),i()())}function G(r,t){if(r&1){let e=y();n(0,"table",21)(1,"thead")(2,"tr")(3,"th"),o(4,"Admin"),i(),n(5,"th"),o(6,"Action"),i(),n(7,"th"),o(8,"Resource"),i(),n(9,"th"),o(10,"Details"),i(),n(11,"th"),o(12,"Date"),i()()(),n(13,"tbody"),P(14,J,20,10,"tr",null,R,!1,q,3,0,"tr"),i()(),n(17,"div",22)(18,"button",23),c("click",function(){x(e);let s=g();return h(s.prevPage())}),o(19,"\u2190 Prev"),i(),n(20,"span",24),o(21),i(),n(22,"button",23),c("click",function(){x(e);let s=g();return h(s.nextPage())}),o(23,"Next \u2192"),i(),n(24,"span",25),o(25),i()()}if(r&2){let e=g();l(14),A(e.logs()),l(4),C("disabled",e.page()<=1),l(3),w("Page ",e.page()," of ",e.pages()),l(),C("disabled",e.page()>=e.pages()),l(3),E("",e.total()," total")}}var B=class r{constructor(t){this.api=t}logs=p([]);loading=p(!0);page=p(1);pages=p(1);total=p(0);filterAction="";filterFromDate="";filterToDate="";ngOnInit(){this.load()}async load(){this.loading.set(!0);try{let t={page:this.page(),limit:50};this.filterAction&&(t.action=this.filterAction),this.filterFromDate&&(t.fromDate=this.filterFromDate),this.filterToDate&&(t.toDate=this.filterToDate);let e=await this.api.getAuditLog(t);this.logs.set(e.logs),this.total.set(e.total),this.pages.set(Math.max(1,e.pages||1))}catch{}this.loading.set(!1)}prevPage(){this.page.update(t=>Math.max(1,t-1)),this.load()}nextPage(){this.page.update(t=>t+1),this.load()}formatDetails(t){if(!t)return"\u2014";let e=[];return t.email&&e.push(t.email),t.tier&&e.push("tier: "+t.tier),t.isSuspended!==void 0&&e.push("suspended: "+t.isSuspended),t.isActive!==void 0&&e.push("active: "+t.isActive),t.featured!==void 0&&e.push("featured: "+t.featured),t.fullName&&e.push(t.fullName),t.reason&&e.push("reason: "+t.reason),t.title&&e.push(t.title),t.maintenanceMode!==void 0&&e.push("maintenance: "+t.maintenanceMode),t.maxPhotosPerUser!==void 0&&e.push("maxPhotos: "+t.maxPhotosPerUser),t.participants&&e.push("with: "+t.participants),e.length?e.join(", "):JSON.stringify(t)}static \u0275fac=function(e){return new(e||r)(v(U))};static \u0275cmp=M({type:r,selectors:[["app-audit-log"]],decls:38,vars:4,consts:[[1,"audit-page"],[1,"filters"],[1,"select-filter",3,"ngModelChange","ngModel"],["value",""],["value","suspend_user"],["value","verify_user"],["value","set_membership"],["value","delete_user"],["value","deactivate_profile"],["value","feature_profile"],["value","resolve_report"],["value","dismiss_report"],["value","update_settings"],["value","create_announcement"],["value","update_announcement"],["value","delete_announcement"],["value","view_conversation"],["value","impersonate_user"],["type","date",1,"date-filter",3,"ngModelChange","ngModel"],[1,"table-card"],[1,"loading"],[1,"admin-table"],[1,"pagination"],[1,"btn-page",3,"click","disabled"],[1,"page-info"],[1,"total-info"],[1,"user-cell"],[1,"user-avatar"],[1,"user-name"],[1,"user-email"],[1,"action-badge"],[1,"details-cell"],[1,"date-cell"],["colspan","5",1,"empty-row"]],template:function(e,a){e&1&&(n(0,"div",0)(1,"div",1)(2,"select",2),_("ngModelChange",function(d){return f(a.filterAction,d)||(a.filterAction=d),d}),c("ngModelChange",function(){return a.load()}),n(3,"option",3),o(4,"All Actions"),i(),n(5,"option",4),o(6,"Suspend User"),i(),n(7,"option",5),o(8,"Verify User"),i(),n(9,"option",6),o(10,"Set Membership"),i(),n(11,"option",7),o(12,"Delete User"),i(),n(13,"option",8),o(14,"Deactivate Profile"),i(),n(15,"option",9),o(16,"Feature Profile"),i(),n(17,"option",10),o(18,"Resolve Report"),i(),n(19,"option",11),o(20,"Dismiss Report"),i(),n(21,"option",12),o(22,"Update Settings"),i(),n(23,"option",13),o(24,"Create Announcement"),i(),n(25,"option",14),o(26,"Update Announcement"),i(),n(27,"option",15),o(28,"Delete Announcement"),i(),n(29,"option",16),o(30,"View Conversation"),i(),n(31,"option",17),o(32,"Impersonate User"),i()(),n(33,"input",18),_("ngModelChange",function(d){return f(a.filterFromDate,d)||(a.filterFromDate=d),d}),c("ngModelChange",function(){return a.load()}),i(),n(34,"input",18),_("ngModelChange",function(d){return f(a.filterToDate,d)||(a.filterToDate=d),d}),c("ngModelChange",function(){return a.load()}),i()(),n(35,"div",19),b(36,j,2,0,"div",20)(37,G,26,6),i()()),e&2&&(l(2),u("ngModel",a.filterAction),l(31),u("ngModel",a.filterFromDate),l(),u("ngModel",a.filterToDate),l(2),S(a.loading()?36:37))},dependencies:[L,W,F,V,T,z,N,k,I],styles:[".audit-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.filters[_ngcontent-%COMP%]{display:flex;gap:.75rem;flex-wrap:wrap}.select-filter[_ngcontent-%COMP%], .date-filter[_ngcontent-%COMP%]{padding:.6rem .9rem;border-radius:8px;border:1px solid #334155;background:#1e293b;color:#f1f5f9;font-size:.9rem;outline:none}.table-card[_ngcontent-%COMP%]{background:#1e293b;border-radius:12px;border:1px solid #334155;overflow:hidden}.loading[_ngcontent-%COMP%], .empty-row[_ngcontent-%COMP%]{color:#94a3b8;text-align:center;padding:3rem}.admin-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#0f172a}th[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px;padding:.75rem 1rem;text-align:left}td[_ngcontent-%COMP%]{padding:.85rem 1rem;border-top:1px solid #334155;color:#f1f5f9;font-size:.9rem;vertical-align:middle}.user-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#6366f1;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;flex-shrink:0}.user-name[_ngcontent-%COMP%]{font-weight:600;color:#f1f5f9}.user-email[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.action-badge[_ngcontent-%COMP%]{padding:.25rem .6rem;border-radius:12px;font-size:.75rem;font-weight:600;background:#334155}.details-cell[_ngcontent-%COMP%]{color:#94a3b8;font-size:.85rem;max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.date-cell[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.25rem;border-top:1px solid #334155}.btn-page[_ngcontent-%COMP%]{padding:.4rem .9rem;border-radius:6px;border:1px solid #334155;background:#0f172a;color:#94a3b8;font-size:.85rem;cursor:pointer}.btn-page[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{color:#94a3b8;font-size:.85rem}.total-info[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem;margin-left:auto}"]})};export{B as AuditLogComponent};
