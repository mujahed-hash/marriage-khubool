import{b as g}from"./chunk-YRFZ7VUJ.js";import{n as u,q as m,x as o}from"./chunk-AY3CH6AK.js";var n="khubool_user",c=class a{constructor(t){this.api=t;let e=this.api.getToken(),r=localStorage.getItem(n);e&&r&&(this.currentUser.set(JSON.parse(r)),this.isAuthenticatedSignal.set(!0))}currentUser=o(null);isAuthenticatedSignal=o(!1);get user(){return this.currentUser.asReadonly()}get isAuthenticated(){return this.isAuthenticatedSignal.asReadonly()}mapUser(t){return{id:t.id,email:t.email,name:t.fullName||t.email.split("@")[0],fullName:t.fullName,membership:t.membershipTier||"bronze"}}async login(t,e){try{let i=await this.api.post("/auth/login",{email:t,password:e});this.api.setToken(i.token);let s=this.mapUser(i.user);return this.currentUser.set(s),this.isAuthenticatedSignal.set(!0),localStorage.setItem(n,JSON.stringify(s)),{ok:!0}}catch(r){return{ok:!1,error:r.message}}}async register(t,e,r){try{let s=await this.api.post("/auth/register",{email:t,password:e,fullName:r});this.api.setToken(s.token);let l=this.mapUser(s.user);return this.currentUser.set(l),this.isAuthenticatedSignal.set(!0),localStorage.setItem(n,JSON.stringify(l)),{ok:!0}}catch(i){return{ok:!1,error:i.message}}}logout(){this.currentUser.set(null),this.isAuthenticatedSignal.set(!1),this.api.clearToken(),localStorage.removeItem(n)}async refreshSession(){if(!this.api.getToken())return!1;try{let e=await this.api.get("/auth/me"),r=e.id??e._id;if(r&&e.email){let i=this.mapUser({id:String(r),email:e.email,fullName:e.fullName,membershipTier:e.membershipTier});return this.currentUser.set(i),this.isAuthenticatedSignal.set(!0),localStorage.setItem(n,JSON.stringify(i)),!0}}catch{this.logout()}return!1}static \u0275fac=function(e){return new(e||a)(m(g))};static \u0275prov=u({token:a,factory:a.\u0275fac,providedIn:"root"})};export{c as a};
