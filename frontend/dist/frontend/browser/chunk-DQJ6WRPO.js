import{Ra as b,a as h,b as p,c as f,n as k,r as w}from"./chunk-AY3CH6AK.js";var E={production:!0,apiUrl:"https://khuboolhai.com/api",uploadsBaseUrl:"https://khuboolhai.com/"};var g="khubool_token",v=class m{baseUrl=E.apiUrl;router=w(b);getToken(){return localStorage.getItem(g)}setToken(t){localStorage.setItem(g,t)}clearToken(){localStorage.removeItem(g)}async request(t,e={}){let d=e,{params:s}=d,n=f(d,["params"]),a=`${this.baseUrl}${t}`;if(s&&Object.keys(s).length>0){let u=new URLSearchParams(s).toString();a+=(a.includes("?")?"&":"?")+u}let i=h({"Content-Type":"application/json"},n.headers),c=this.getToken();c&&(i.Authorization=`Bearer ${c}`);let r=new AbortController,l=setTimeout(()=>r.abort(),15e3),o;try{o=await fetch(a,p(h({},n),{headers:i,signal:r.signal}))}catch(u){throw clearTimeout(l),u.name==="AbortError"?new Error("Request timeout. Is the backend running?"):new Error(u.message||"Network error")}clearTimeout(l);let T=await o.json().catch(()=>({}));if(!o.ok)throw o.status===401&&(this.clearToken(),localStorage.removeItem("khubool_user"),this.router.navigate(["/login"])),new Error(T.message||`Request failed: ${o.status}`);return T}get(t,e){return this.request(t,{method:"GET",params:e})}post(t,e){return this.request(t,{method:"POST",body:JSON.stringify(e)})}put(t,e){return this.request(t,{method:"PUT",body:JSON.stringify(e)})}delete(t){return this.request(t,{method:"DELETE"})}async upload(t,e){let s=this.getToken(),n={};s&&(n.Authorization=`Bearer ${s}`);let a=`${this.baseUrl}${t}`,i=new AbortController,c=setTimeout(()=>i.abort(),3e4),r;try{r=await fetch(a,{method:"POST",headers:n,body:e,signal:i.signal})}catch(o){throw clearTimeout(c),o.name==="AbortError"?new Error("Upload timeout."):new Error(o.message||"Network error")}clearTimeout(c);let l=await r.json().catch(()=>({}));if(!r.ok)throw r.status===401&&(this.clearToken(),localStorage.removeItem("khubool_user"),this.router.navigate(["/login"])),new Error(l.message||`Upload failed: ${r.status}`);return l}static \u0275fac=function(e){return new(e||m)};static \u0275prov=k({token:m,factory:m.\u0275fac,providedIn:"root"})};export{E as a,v as b};
