import{$b as U,Ca as E,Cb as D,Db as z,Eb as A,La as x,Ma as v,Oa as y,Ob as V,Pa as T,Qa as h,R as _,Ra as t,Rb as B,S as b,Sa as n,Ub as F,Vb as L,Wb as W,Xa as M,Za as m,_a as p,_b as R,aa as c,ab as k,cb as i,db as g,eb as u,fb as I,gb as O,hb as S,ib as P,kb as f,lb as C,mb as N,pa as a,xa as w}from"./chunk-RU7WV6XK.js";var G=(l,o)=>o._id;function Y(l,o){l&1&&(t(0,"div",18),i(1,"Loading orders..."),n())}function q(l,o){if(l&1){let e=M();t(0,"button",34),m("click",function(){_(e);let d=p().$implicit,s=p(2);return b(s.grantTier(d))}),i(1,"\u2191 Grant"),n()}}function H(l,o){if(l&1&&(t(0,"tr")(1,"td")(2,"div",25)(3,"div",26),i(4),n(),t(5,"div")(6,"div",27),i(7),n(),t(8,"div",28),i(9),n()()()(),t(10,"td")(11,"span",29),i(12),n()(),t(13,"td",30),i(14),f(15,"number"),n(),t(16,"td")(17,"span",31),i(18),n()(),t(19,"td",32),i(20),f(21,"date"),n(),t(22,"td"),x(23,q,2,0,"button",33),n()()),l&2){let e=o.$implicit;a(4),g((e.userId==null||e.userId.fullName==null?null:e.userId.fullName.charAt(0))||"?"),a(3),g((e.userId==null?null:e.userId.fullName)||"\u2014"),a(2),g(e.userId==null?null:e.userId.email),a(3),g(e.plan),a(2),u("\u20B9",C(15,14,e.amount)),a(3),k("completed",e.status==="completed")("pending",e.status==="pending")("failed",e.status==="failed"),a(),u(" ",e.status," "),a(2),g(N(21,16,e.createdAt,"medium")),a(3),v(e.userId?23:-1)}}function J(l,o){l&1&&(t(0,"tr")(1,"td",35),i(2,"No orders found."),n()())}function K(l,o){if(l&1){let e=M();t(0,"table",20)(1,"thead")(2,"tr")(3,"th"),i(4,"User"),n(),t(5,"th"),i(6,"Plan"),n(),t(7,"th"),i(8,"Amount"),n(),t(9,"th"),i(10,"Status"),n(),t(11,"th"),i(12,"Date"),n(),t(13,"th"),i(14,"Actions"),n()()(),t(15,"tbody"),y(16,H,24,19,"tr",null,G,!1,J,3,0,"tr"),n()(),t(19,"div",21)(20,"button",22),m("click",function(){_(e);let d=p();return b(d.prevPage())}),i(21,"\u2190 Prev"),n(),t(22,"span",23),i(23),n(),t(24,"button",22),m("click",function(){_(e);let d=p();return b(d.nextPage())}),i(25,"Next \u2192"),n(),t(26,"span",24),i(27),n()()}if(l&2){let e=p();a(16),T(e.orders()),a(4),h("disabled",e.page()<=1),a(3),I("Page ",e.page()," of ",e.pages()),a(),h("disabled",e.page()>=e.pages()),a(3),u("",e.total()," total")}}function Q(l,o){if(l&1&&(t(0,"div",19),i(1),n()),l&2){let e=p();a(),g(e.toast())}}var j=class l{constructor(o){this.api=o}orders=c([]);loading=c(!0);page=c(1);pages=c(1);total=c(0);revenueTotal=c(0);revenueThisMonth=c(0);filterStatus="";filterPlan="";toast=c("");ngOnInit(){this.load()}async load(){this.loading.set(!0);try{let o={page:this.page(),limit:20};this.filterStatus&&(o.status=this.filterStatus),this.filterPlan&&(o.plan=this.filterPlan);let e=await this.api.getOrders(o);this.orders.set(e.orders),this.total.set(e.total),this.pages.set(Math.max(1,e.pages||1)),this.revenueTotal.set(e.revenueTotal??0),this.revenueThisMonth.set(e.revenueThisMonth??0)}catch{}this.loading.set(!1)}prevPage(){this.page.update(o=>Math.max(1,o-1)),this.load()}nextPage(){this.page.update(o=>o+1),this.load()}async exportCsv(){try{let o={};this.filterStatus&&(o.status=this.filterStatus),this.filterPlan&&(o.plan=this.filterPlan);let e=await this.api.exportOrders(o),r=document.createElement("a");r.href=URL.createObjectURL(e),r.download="orders.csv",r.click(),URL.revokeObjectURL(r.href),this.showToast("Export downloaded.")}catch{this.showToast("Export failed.")}}async grantTier(o){let e=o.userId?._id??o.userId;if(!e)return;let r=o.plan||"gold";try{await this.api.setMembership(String(e),r),this.showToast(`Tier ${r} granted to user.`)}catch{this.showToast("Failed to grant tier.")}}showToast(o){this.toast.set(o),setTimeout(()=>this.toast.set(""),3e3)}static \u0275fac=function(e){return new(e||l)(w(U))};static \u0275cmp=E({type:l,selectors:[["app-orders"]],decls:41,vars:10,consts:[[1,"orders-page"],[1,"revenue-cards"],[1,"rev-card"],[1,"rev-label"],[1,"rev-value"],[1,"rev-card","accent"],[1,"filters"],[1,"select-filter",3,"ngModelChange","ngModel"],["value",""],["value","pending"],["value","completed"],["value","failed"],["value","silver"],["value","gold"],["value","diamond"],["value","crown"],[1,"btn-export",3,"click"],[1,"table-card"],[1,"loading"],[1,"toast"],[1,"admin-table"],[1,"pagination"],[1,"btn-page",3,"click","disabled"],[1,"page-info"],[1,"total-info"],[1,"user-cell"],[1,"user-avatar"],[1,"user-name"],[1,"user-email"],[1,"plan-badge"],[1,"amount-cell"],[1,"status-badge"],[1,"date-cell"],["title","Grant tier manually",1,"btn-action","green"],["title","Grant tier manually",1,"btn-action","green",3,"click"],["colspan","6",1,"empty-row"]],template:function(e,r){e&1&&(t(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),i(4,"Total Revenue"),n(),t(5,"div",4),i(6),f(7,"number"),n()(),t(8,"div",5)(9,"div",3),i(10,"This Month"),n(),t(11,"div",4),i(12),f(13,"number"),n()()(),t(14,"div",6)(15,"select",7),P("ngModelChange",function(s){return S(r.filterStatus,s)||(r.filterStatus=s),s}),m("ngModelChange",function(){return r.load()}),t(16,"option",8),i(17,"All Status"),n(),t(18,"option",9),i(19,"Pending"),n(),t(20,"option",10),i(21,"Completed"),n(),t(22,"option",11),i(23,"Failed"),n()(),t(24,"select",7),P("ngModelChange",function(s){return S(r.filterPlan,s)||(r.filterPlan=s),s}),m("ngModelChange",function(){return r.load()}),t(25,"option",8),i(26,"All Plans"),n(),t(27,"option",12),i(28,"Silver"),n(),t(29,"option",13),i(30,"Gold"),n(),t(31,"option",14),i(32,"Diamond"),n(),t(33,"option",15),i(34,"Crown"),n()(),t(35,"button",16),m("click",function(){return r.exportCsv()}),i(36,"\u{1F4E5} Export CSV"),n()(),t(37,"div",17),x(38,Y,2,0,"div",18)(39,K,28,6),n(),x(40,Q,2,1,"div",19),n()),e&2&&(a(6),u("\u20B9",C(7,6,r.revenueTotal())),a(6),u("\u20B9",C(13,8,r.revenueThisMonth())),a(3),O("ngModel",r.filterStatus),a(9),O("ngModel",r.filterPlan),a(14),v(r.loading()?38:39),a(2),v(r.toast()?40:-1))},dependencies:[A,R,L,W,F,V,B,z,D],styles:[".orders-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.revenue-cards[_ngcontent-%COMP%]{display:flex;gap:1rem;flex-wrap:wrap}.rev-card[_ngcontent-%COMP%]{background:#1e293b;border-radius:12px;padding:1.5rem;min-width:180px;border:1px solid #334155}.rev-card.accent[_ngcontent-%COMP%]{border-left:4px solid #10b981}.rev-label[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px}.rev-value[_ngcontent-%COMP%]{color:#f1f5f9;font-size:1.5rem;font-weight:800;margin-top:.25rem}.filters[_ngcontent-%COMP%]{display:flex;gap:.75rem}.select-filter[_ngcontent-%COMP%]{padding:.6rem .9rem;border-radius:8px;border:1px solid #334155;background:#1e293b;color:#f1f5f9;font-size:.9rem;outline:none}.btn-export[_ngcontent-%COMP%]{padding:.6rem 1rem;border-radius:8px;border:1px solid #10b981;background:transparent;color:#10b981;font-size:.9rem;font-weight:600;cursor:pointer}.btn-export[_ngcontent-%COMP%]:hover{background:#10b981;color:#fff}.table-card[_ngcontent-%COMP%]{background:#1e293b;border-radius:12px;border:1px solid #334155;overflow:hidden}.loading[_ngcontent-%COMP%], .empty-row[_ngcontent-%COMP%]{color:#94a3b8;text-align:center;padding:3rem}.admin-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#0f172a}th[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px;padding:.75rem 1rem;text-align:left}td[_ngcontent-%COMP%]{padding:.85rem 1rem;border-top:1px solid #334155;color:#f1f5f9;font-size:.9rem;vertical-align:middle}.user-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#6366f1;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;flex-shrink:0}.user-name[_ngcontent-%COMP%]{font-weight:600;color:#f1f5f9}.user-email[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.plan-badge[_ngcontent-%COMP%]{padding:.25rem .6rem;border-radius:12px;font-size:.75rem;font-weight:700;text-transform:uppercase;background:#334155}.amount-cell[_ngcontent-%COMP%]{font-weight:700;color:#10b981}.date-cell[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.status-badge[_ngcontent-%COMP%]{padding:.2rem .6rem;border-radius:12px;font-size:.75rem;font-weight:600}.status-badge.completed[_ngcontent-%COMP%]{background:#052e16;color:#4ade80}.status-badge.pending[_ngcontent-%COMP%]{background:#451a03;color:#fb923c}.status-badge.failed[_ngcontent-%COMP%]{background:#450a0a;color:#f87171}.btn-action[_ngcontent-%COMP%]{padding:.4rem .75rem;border-radius:6px;border:none;cursor:pointer;font-size:.8rem;font-weight:600;background:#064e3b;color:#4ade80}.btn-action[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.25rem;border-top:1px solid #334155}.btn-page[_ngcontent-%COMP%]{padding:.4rem .9rem;border-radius:6px;border:1px solid #334155;background:#0f172a;color:#94a3b8;font-size:.85rem;cursor:pointer}.btn-page[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{color:#94a3b8;font-size:.85rem}.total-info[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem;margin-left:auto}.toast[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;background:#1e293b;border:1px solid #10b981;color:#10b981;padding:.75rem 1.25rem;border-radius:10px;font-size:.9rem;font-weight:600;z-index:200}"]})};export{j as OrdersComponent};
