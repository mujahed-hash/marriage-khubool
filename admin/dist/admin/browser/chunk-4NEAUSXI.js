import{$b as j,Ca as O,Cb as k,Eb as T,La as C,Ma as _,Nb as D,Oa as f,Ob as F,Pa as u,Qa as x,R as P,Ra as o,Rb as A,S as w,Sa as a,Xa as S,Za as g,_a as c,_b as z,aa as l,ab as b,cb as s,db as m,fb as v,gb as E,hb as I,ib as N,kb as h,mb as M,pa as r,xa as y}from"./chunk-RU7WV6XK.js";var V=(n,t)=>t._id;function B(n,t){n&1&&(o(0,"div",8),s(1,"Loading..."),a())}function W(n,t){if(n&1){let e=S();o(0,"div",15),g("click",function(){let d=P(e).$implicit,p=c(2);return w(p.selectConversation(d))}),o(1,"div",16)(2,"div",17),s(3),a(),o(4,"div",18),s(5),a()(),o(6,"div",19)(7,"span",20),s(8),h(9,"date"),a(),o(10,"span",21),s(11),a()()()}if(n&2){let e=t.$implicit,i=c(2);b("active",i.selectedId()===e._id),r(3),v("",e.participants[0]==null?null:e.participants[0].fullName," & ",e.participants[1]==null?null:e.participants[1].fullName),r(2),v("",e.participants[0]==null?null:e.participants[0].email," / ",e.participants[1]==null?null:e.participants[1].email),r(3),m(M(9,8,e.lastMessageAt,"short")),r(3),m(e.lastMessage)}}function U(n,t){n&1&&(o(0,"div",14),s(1,"No conversations found."),a())}function $(n,t){if(n&1&&f(0,W,12,11,"div",13,V,!1,U,2,0,"div",14),n&2){let e=c();u(e.conversations())}}function q(n,t){n&1&&(o(0,"div",8),s(1,"Loading messages..."),a())}function G(n,t){if(n&1&&(o(0,"div",27)(1,"div",28)(2,"div",29),s(3),a(),o(4,"div",30),s(5),a(),o(6,"div",31),s(7),h(8,"date"),a()()()),n&2){let e,i=t.$implicit,d=c(3);b("sent",i.senderId===((e=d.selectedConv().participants[0])==null?null:e._id)),r(3),m(d.getSenderName(i.senderId)),r(2),m(i.text),r(2),m(M(8,5,i.createdAt,"shortTime"))}}function H(n,t){n&1&&(o(0,"div",14),s(1,"No messages in this conversation."),a())}function J(n,t){if(n&1&&f(0,G,9,8,"div",26,V,!1,H,2,0,"div",14),n&2){let e=c(2);u(e.messages())}}function K(n,t){if(n&1&&(o(0,"div",22)(1,"div",23)(2,"h4"),s(3),a(),o(4,"span",24),s(5,"\u26A0\uFE0F All views are logged for audit purposes."),a()()(),o(6,"div",25,0),C(8,q,2,0,"div",8)(9,J,3,1),a()),n&2){let e,i=c();r(3),v("Audit: ",(e=i.selectedConv().participants[0])==null?null:e.fullName," & ",(e=i.selectedConv().participants[1])==null?null:e.fullName),r(5),_(i.loadingMessages()?8:9)}}function Q(n,t){n&1&&(o(0,"div",12)(1,"div",32),s(2,"\u{1F4AC}"),a(),o(3,"h3"),s(4,"Select a conversation to audit"),a(),o(5,"p"),s(6,"Message history will be retrieved securely from the backend."),a()())}var L=class n{constructor(t){this.api=t}conversations=l([]);messages=l([]);loadingConversations=l(!0);loadingMessages=l(!1);selectedId=l(null);selectedConv=l(null);userIdFilter="";page=l(1);pages=l(1);ngOnInit(){this.loadConversations()}async loadConversations(){this.loadingConversations.set(!0);try{let t=await this.api.getConversations({page:this.page(),limit:15,userId:this.userIdFilter});this.conversations.set(t.conversations),this.pages.set(t.pages)}catch{}this.loadingConversations.set(!1)}async selectConversation(t){this.selectedId.set(t._id),this.selectedConv.set(t),this.loadingMessages.set(!0);try{let e=await this.api.getConversationMessages(t._id);this.messages.set(e.messages)}catch{}this.loadingMessages.set(!1)}getSenderName(t){return this.selectedConv()?.participants.find(i=>i._id===t)?.fullName||"User"}prevPage(){this.page.update(t=>t-1),this.loadConversations()}nextPage(){this.page.update(t=>t+1),this.loadConversations()}static \u0275fac=function(e){return new(e||n)(y(j))};static \u0275cmp=O({type:n,selectors:[["app-conversations"]],decls:21,vars:7,consts:[["msgList",""],[1,"conv-page"],[1,"conv-container"],[1,"conv-list-panel"],[1,"panel-header"],[1,"search-box"],["type","text","placeholder","Filter by User ID...",1,"input-search",3,"ngModelChange","ngModel"],[1,"list-scroll"],[1,"loading-state"],[1,"list-footer"],[3,"click","disabled"],[1,"conv-viewer-panel"],[1,"no-selection"],[1,"conv-item",3,"active"],[1,"empty-state"],[1,"conv-item",3,"click"],[1,"participants"],[1,"p-names"],[1,"p-emails"],[1,"last-meta"],[1,"last-time"],[1,"msg-preview"],[1,"viewer-header"],[1,"chat-title"],[1,"audit-warning"],[1,"message-list"],[1,"msg-row",3,"sent"],[1,"msg-row"],[1,"msg-bubble"],[1,"msg-sender"],[1,"msg-text"],[1,"msg-time"],[1,"placeholder-icon"]],template:function(e,i){e&1&&(o(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"h3"),s(5,"Conversations"),a(),o(6,"div",5)(7,"input",6),N("ngModelChange",function(p){return I(i.userIdFilter,p)||(i.userIdFilter=p),p}),g("ngModelChange",function(){return i.loadConversations()}),a()()(),o(8,"div",7),C(9,B,2,0,"div",8)(10,$,3,1),a(),o(11,"div",9)(12,"button",10),g("click",function(){return i.prevPage()}),s(13,"\u2190"),a(),o(14,"span"),s(15),a(),o(16,"button",10),g("click",function(){return i.nextPage()}),s(17,"\u2192"),a()()(),o(18,"div",11),C(19,K,10,3)(20,Q,7,0,"div",12),a()()()),e&2&&(r(7),E("ngModel",i.userIdFilter),r(2),_(i.loadingConversations()?9:10),r(3),x("disabled",i.page()<=1),r(3),v("",i.page()," / ",i.pages()),r(),x("disabled",i.page()>=i.pages()),r(3),_(i.selectedConv()?19:20))},dependencies:[T,z,D,F,A,k],styles:[".conv-page[_ngcontent-%COMP%]{height:calc(100vh - 120px)}.conv-container[_ngcontent-%COMP%]{display:flex;height:100%;background:#1e293b;border:1px solid #334155;border-radius:12px;overflow:hidden}.conv-list-panel[_ngcontent-%COMP%]{width:350px;display:flex;flex-direction:column;border-right:1px solid #334155;background:#0f172a}.panel-header[_ngcontent-%COMP%]{padding:1.25rem;border-bottom:1px solid #334155}.panel-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 1rem;color:#f1f5f9;font-size:1.1rem}.input-search[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;background:#1e293b;border:1px solid #334155;border-radius:6px;color:#f1f5f9;font-size:.85rem}.list-scroll[_ngcontent-%COMP%]{flex:1;overflow-y:auto}.conv-item[_ngcontent-%COMP%]{padding:1rem 1.25rem;border-bottom:1px solid #1e293b;cursor:pointer;transition:all .2s}.conv-item[_ngcontent-%COMP%]:hover{background:#1e293b}.conv-item.active[_ngcontent-%COMP%]{background:#334155;border-left:4px solid #6366f1}.participants[_ngcontent-%COMP%]{margin-bottom:.5rem}.p-names[_ngcontent-%COMP%]{color:#f1f5f9;font-weight:600;font-size:.9rem}.p-emails[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.last-meta[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.2rem}.last-time[_ngcontent-%COMP%]{color:#475569;font-size:.7rem}.msg-preview[_ngcontent-%COMP%]{color:#94a3b8;font-size:.8rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.list-footer[_ngcontent-%COMP%]{padding:.75rem;border-top:1px solid #334155;display:flex;align-items:center;justify-content:space-between;color:#94a3b8;font-size:.8rem}.list-footer[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.25rem .5rem;background:transparent;border:1px solid #334155;color:#f1f5f9;border-radius:4px;cursor:pointer}.conv-viewer-panel[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:#1e293b}.viewer-header[_ngcontent-%COMP%]{padding:1.25rem;background:#0f172a;border-bottom:1px solid #334155}.chat-title[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0;color:#f1f5f9}.audit-warning[_ngcontent-%COMP%]{color:#f59e0b;font-size:.75rem;font-weight:600}.message-list[_ngcontent-%COMP%]{flex:1;overflow-y:auto;padding:1.5rem;display:flex;flex-direction:column;gap:1rem}.msg-row[_ngcontent-%COMP%]{display:flex}.msg-row.sent[_ngcontent-%COMP%]{justify-content:flex-end}.msg-bubble[_ngcontent-%COMP%]{max-width:70%;padding:.75rem 1rem;border-radius:12px;background:#334155;color:#f1f5f9;position:relative}.msg-row.sent[_ngcontent-%COMP%]   .msg-bubble[_ngcontent-%COMP%]{background:#6366f1}.msg-sender[_ngcontent-%COMP%]{font-size:.7rem;font-weight:700;text-transform:uppercase;margin-bottom:.25rem;opacity:.8}.msg-text[_ngcontent-%COMP%]{font-size:.9rem;line-height:1.5}.msg-time[_ngcontent-%COMP%]{font-size:.65rem;color:#94a3b8;text-align:right;margin-top:.25rem}.msg-row.sent[_ngcontent-%COMP%]   .msg-time[_ngcontent-%COMP%]{color:#c7d2fe}.no-selection[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#64748b;padding:3rem;text-align:center}.placeholder-icon[_ngcontent-%COMP%]{font-size:4rem;margin-bottom:1rem;opacity:.2}.loading-state[_ngcontent-%COMP%], .empty-state[_ngcontent-%COMP%]{padding:2rem;color:#64748b;text-align:center;font-style:italic}"]})};export{L as ConversationsComponent};
