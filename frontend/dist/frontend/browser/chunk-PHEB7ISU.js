import{b as V,c as N,d as T,e as W,f as j,g as F,o as q,p as z}from"./chunk-AKKU7WAO.js";import{a as R}from"./chunk-BRHAC2FS.js";import{b as A}from"./chunk-DQJ6WRPO.js";import{E as s,H as d,I as C,Ja as P,La as O,N as u,Pa as L,Ra as I,Sa as k,Ua as E,W as p,X as t,Y as o,Z as b,da as w,fa as x,ha as y,la as M,pa as r,ra as S,s as c,t as g,ta as f,ua as h,va as _}from"./chunk-AY3CH6AK.js";function B(a,n){if(a&1&&(t(0,"div",17),r(1),o()),a&2){let e=y();s(),S(" ",e.error," ")}}function G(a,n){a&1&&(t(0,"span"),r(1,"Login "),b(2,"i",18),o())}function U(a,n){a&1&&(t(0,"span"),r(1,"Please wait..."),o())}var D=class a{constructor(n,e,i,m){this.authService=n;this.router=e;this.route=i;this.api=m;this.checkImpersonation()}email="";password="";error="";loading=!1;async checkImpersonation(){let n=this.route.snapshot.queryParamMap.get("token");if(n){this.loading=!0;try{if(this.api.setToken(n),await this.authService.refreshSession()){this.router.navigate(["/"]);return}}catch(e){console.error("Impersonation failed:",e)}finally{this.loading=!1}}}async onLogin(){this.error="",this.loading=!0;try{let n=await this.authService.login(this.email,this.password);if(n.ok){let e=this.route.snapshot.queryParamMap.get("redirect");this.router.navigateByUrl(e&&e.startsWith("/")?e:"/")}else this.error=n.error||"Invalid email or password"}catch(n){this.error=n.message||"Login failed. Is the backend running?"}finally{this.loading=!1}}static \u0275fac=function(e){return new(e||a)(d(R),d(I),d(L),d(A))};static \u0275cmp=C({type:a,selectors:[["app-login"]],decls:27,vars:6,consts:[["loginForm","ngForm"],[1,"auth-container"],[1,"auth-card","tier-glow"],[1,"auth-header"],[1,"tier-color"],[1,"auth-form",3,"ngSubmit"],[1,"form-group"],["for","email"],["type","email","id","email","name","email","required","","placeholder","Enter your email",1,"custom-input",3,"ngModelChange","ngModel"],["for","password"],["type","password","id","password","name","password","required","","placeholder","\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",1,"custom-input",3,"ngModelChange","ngModel"],["class","error-message",4,"ngIf"],[1,"form-actions"],["type","submit",1,"tier-bg","submit-btn",3,"disabled"],[4,"ngIf"],[1,"auth-footer"],["routerLink","/register",1,"tier-color"],[1,"error-message"],[1,"fa-solid","fa-right-to-bracket"]],template:function(e,i){if(e&1){let m=w();t(0,"div",1)(1,"div",2)(2,"div",3)(3,"h2",4),r(4,"Welcome Back"),o(),t(5,"p"),r(6,"Login to your account to continue"),o()(),t(7,"form",5,0),x("ngSubmit",function(){return c(m),g(i.onLogin())}),t(9,"div",6)(10,"label",7),r(11,"Email Address"),o(),t(12,"input",8),_("ngModelChange",function(l){return c(m),h(i.email,l)||(i.email=l),g(l)}),o()(),t(13,"div",6)(14,"label",9),r(15,"Password"),o(),t(16,"input",10),_("ngModelChange",function(l){return c(m),h(i.password,l)||(i.password=l),g(l)}),o()(),u(17,B,2,1,"div",11),t(18,"div",12)(19,"button",13),u(20,G,3,0,"span",14)(21,U,2,0,"span",14),o()()(),t(22,"div",15)(23,"p"),r(24,"Don't have an account? "),t(25,"a",16),r(26,"Register here"),o()()()()()}if(e&2){let m=M(8);s(12),f("ngModel",i.email),s(4),f("ngModel",i.password),s(),p("ngIf",i.error),s(2),p("disabled",!m.form.valid||i.loading),s(),p("ngIf",!i.loading),s(),p("ngIf",i.loading)}},dependencies:[O,P,z,F,V,N,T,q,j,W,E,k],styles:[".auth-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:80vh;padding:2rem}.auth-card[_ngcontent-%COMP%]{background:#fff;padding:2.5rem;border-radius:20px;width:100%;max-width:450px;box-shadow:0 10px 25px #0000000d;border:1px solid rgba(0,0,0,.05)}.auth-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.auth-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:2rem;margin-bottom:.5rem}.auth-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#666}.auth-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:500;font-size:.9rem;color:#444}.custom-input[_ngcontent-%COMP%]{padding:12px 16px;border-radius:10px;border:1.5px solid #eee;background:#f9f9f9;transition:all .3s;outline:none}.custom-input[_ngcontent-%COMP%]:focus{background:#fff;border-color:var(--tier-primary);box-shadow:0 0 0 4px var(--tier-accent)}.submit-btn[_ngcontent-%COMP%]{width:100%;padding:14px;border-radius:10px;border:none;color:#fff;font-weight:600;font-size:1rem;cursor:pointer;display:flex;justify-content:center;align-items:center;gap:10px;transition:all .3s}.submit-btn[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 5px 15px #0000001a}.submit-btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.auth-footer[_ngcontent-%COMP%]{margin-top:2rem;text-align:center;font-size:.9rem}.auth-footer[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-weight:600;text-decoration:none}.error-message[_ngcontent-%COMP%]{color:#e53e3e;font-size:.85rem;text-align:center;margin-top:1rem}"]})};export{D as LoginComponent};
