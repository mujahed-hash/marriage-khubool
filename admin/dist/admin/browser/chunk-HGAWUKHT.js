import{$b as F,Ca as y,Eb as A,La as b,Ma as h,Nb as E,Oa as v,Ob as T,Pa as S,Qa as O,R as m,Ra as n,Rb as V,S as g,Sa as i,Ta as P,Ub as I,Vb as W,Wb as N,Xa as M,Za as p,_a as s,_b as z,aa as _,bb as k,cb as a,db as x,eb as D,gb as u,hb as f,ib as C,pa as d,xa as w}from"./chunk-RU7WV6XK.js";var B=(c,t)=>t._id;function j(c,t){c&1&&(n(0,"div",5),a(1,"Loading..."),i())}function U(c,t){if(c&1){let e=M();n(0,"tr")(1,"td")(2,"strong"),a(3),i()(),n(4,"td")(5,"span",9),a(6),i()(),n(7,"td")(8,"label",10)(9,"input",11),p("change",function(){let o=m(e).$implicit,l=s(2);return g(l.toggleActive(o))}),i(),P(10,"span",12),i()(),n(11,"td",13),a(12),i(),n(13,"td")(14,"button",14),p("click",function(){let o=m(e).$implicit,l=s(2);return g(l.edit(o))}),a(15,"Edit"),i(),n(16,"button",15),p("click",function(){let o=m(e).$implicit,l=s(2);return g(l.remove(o))}),a(17,"Delete"),i()()()}if(c&2){let e=t.$implicit,r=s(2);d(3),x(e.title),d(2),k(e.type),d(),x(e.type),d(3),O("checked",e.active),d(3),x(r.formatDates(e))}}function q(c,t){c&1&&(n(0,"tr")(1,"td",16),a(2,"No announcements. Create one to show banners on the user app."),i()())}function G(c,t){if(c&1&&(n(0,"table",6)(1,"thead")(2,"tr")(3,"th"),a(4,"Title"),i(),n(5,"th"),a(6,"Type"),i(),n(7,"th"),a(8,"Active"),i(),n(9,"th"),a(10,"Dates"),i(),n(11,"th"),a(12,"Actions"),i()()(),n(13,"tbody"),v(14,U,18,6,"tr",null,B,!1,q,3,0,"tr"),i()()),c&2){let e=s();d(14),S(e.announcements())}}function H(c,t){if(c&1){let e=M();n(0,"div",17),p("click",function(){m(e);let o=s();return g(o.closeModal())}),n(1,"div",18),p("click",function(o){return m(e),g(o.stopPropagation())}),n(2,"h3"),a(3),i(),n(4,"div",19)(5,"label"),a(6,"Title"),i(),n(7,"input",20),C("ngModelChange",function(o){m(e);let l=s();return f(l.form.title,o)||(l.form.title=o),g(o)}),i()(),n(8,"div",19)(9,"label"),a(10,"Message"),i(),n(11,"textarea",21),C("ngModelChange",function(o){m(e);let l=s();return f(l.form.message,o)||(l.form.message=o),g(o)}),i()(),n(12,"div",19)(13,"label"),a(14,"Type"),i(),n(15,"select",22),C("ngModelChange",function(o){m(e);let l=s();return f(l.form.type,o)||(l.form.type=o),g(o)}),n(16,"option",23),a(17,"Info"),i(),n(18,"option",24),a(19,"Warning"),i(),n(20,"option",25),a(21,"Maintenance"),i()()(),n(22,"div",26)(23,"div",19)(24,"label"),a(25,"Start Date"),i(),n(26,"input",27),C("ngModelChange",function(o){m(e);let l=s();return f(l.form.startDate,o)||(l.form.startDate=o),g(o)}),i()(),n(27,"div",19)(28,"label"),a(29,"End Date"),i(),n(30,"input",27),C("ngModelChange",function(o){m(e);let l=s();return f(l.form.endDate,o)||(l.form.endDate=o),g(o)}),i()()(),n(31,"div",28)(32,"button",29),p("click",function(){m(e);let o=s();return g(o.closeModal())}),a(33,"Cancel"),i(),n(34,"button",30),p("click",function(){m(e);let o=s();return g(o.save())}),a(35,"Save"),i()()()()}if(c&2){let e=s();d(3),D("",e.editingId()?"Edit":"New"," Announcement"),d(4),u("ngModel",e.form.title),d(4),u("ngModel",e.form.message),d(4),u("ngModel",e.form.type),d(11),u("ngModel",e.form.startDate),d(4),u("ngModel",e.form.endDate)}}function J(c,t){if(c&1&&(n(0,"div",8),a(1),i()),c&2){let e=s();d(),x(e.toast())}}var L=class c{constructor(t){this.api=t}announcements=_([]);loading=_(!0);showModal=_(!1);editingId=_("");toast=_("");form={title:"",message:"",type:"info",startDate:"",endDate:""};ngOnInit(){this.load()}async load(){this.loading.set(!0);try{let t=await this.api.getAnnouncements();this.announcements.set(t)}catch{}this.loading.set(!1)}openCreate(){this.form={title:"",message:"",type:"info",startDate:"",endDate:""},this.editingId.set(""),this.showModal.set(!0)}edit(t){this.form={title:t.title,message:t.message,type:t.type||"info",startDate:t.startDate?new Date(t.startDate).toISOString().slice(0,16):"",endDate:t.endDate?new Date(t.endDate).toISOString().slice(0,16):""},this.editingId.set(t._id),this.showModal.set(!0)}closeModal(){this.showModal.set(!1)}async save(){if(!this.form.title||!this.form.message){this.showToast("Title and message required.");return}try{let t={title:this.form.title,message:this.form.message,type:this.form.type,startDate:this.form.startDate||void 0,endDate:this.form.endDate||void 0},e=this.editingId();e?(await this.api.updateAnnouncement(e,t),this.showToast("Updated.")):(await this.api.createAnnouncement(t),this.showToast("Created.")),this.closeModal(),this.load()}catch{this.showToast("Failed to save.")}}async toggleActive(t){try{await this.api.updateAnnouncement(t._id,{active:!t.active}),this.load()}catch{}}async remove(t){if(confirm("Delete this announcement?"))try{await this.api.deleteAnnouncement(t._id),this.showToast("Deleted."),this.load()}catch{this.showToast("Failed to delete.")}}formatDates(t){let e=t.startDate?new Date(t.startDate).toLocaleDateString():"",r=t.endDate?new Date(t.endDate).toLocaleDateString():"";return e&&r?e+" \u2013 "+r:e?"From "+e:r?"Until "+r:"\u2014"}showToast(t){this.toast.set(t),setTimeout(()=>this.toast.set(""),3e3)}static \u0275fac=function(e){return new(e||c)(w(F))};static \u0275cmp=y({type:c,selectors:[["app-announcements"]],decls:11,vars:3,consts:[[1,"announcements-page"],[1,"page-header"],[1,"page-title"],[1,"btn-create",3,"click"],[1,"table-card"],[1,"loading"],[1,"admin-table"],[1,"modal-backdrop"],[1,"toast"],[1,"type-badge"],[1,"toggle"],["type","checkbox",3,"change","checked"],[1,"slider"],[1,"date-cell"],[1,"btn-action",3,"click"],[1,"btn-action","red",3,"click"],["colspan","5",1,"empty-row"],[1,"modal-backdrop",3,"click"],[1,"modal",3,"click"],[1,"form-group"],["placeholder","Announcement title",1,"input",3,"ngModelChange","ngModel"],["rows","3","placeholder","Message to display",1,"input",3,"ngModelChange","ngModel"],[1,"input",3,"ngModelChange","ngModel"],["value","info"],["value","warning"],["value","maintenance"],[1,"form-row"],["type","datetime-local",1,"input",3,"ngModelChange","ngModel"],[1,"modal-actions"],[1,"btn-cancel",3,"click"],[1,"btn-save",3,"click"]],template:function(e,r){e&1&&(n(0,"div",0)(1,"div",1)(2,"h2",2),a(3,"Announcements"),i(),n(4,"button",3),p("click",function(){return r.openCreate()}),a(5,"+ New"),i()(),n(6,"div",4),b(7,j,2,0,"div",5)(8,G,17,1,"table",6),i(),b(9,H,36,6,"div",7),b(10,J,2,1,"div",8),i()),e&2&&(d(7),h(r.loading()?7:8),d(2),h(r.showModal()?9:-1),d(),h(r.toast()?10:-1))},dependencies:[A,z,W,N,E,I,T,V],styles:['.announcements-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.page-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.page-title[_ngcontent-%COMP%]{color:#f1f5f9;font-size:1.5rem;font-weight:700;margin:0}.btn-create[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:8px;border:none;background:#10b981;color:#fff;font-weight:600;cursor:pointer}.btn-create[_ngcontent-%COMP%]:hover{background:#059669}.table-card[_ngcontent-%COMP%]{background:#1e293b;border-radius:12px;border:1px solid #334155;overflow:hidden}.loading[_ngcontent-%COMP%], .empty-row[_ngcontent-%COMP%]{color:#94a3b8;text-align:center;padding:3rem}.admin-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#0f172a}th[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px;padding:.75rem 1rem;text-align:left}td[_ngcontent-%COMP%]{padding:.85rem 1rem;border-top:1px solid #334155;color:#f1f5f9;font-size:.9rem}.type-badge[_ngcontent-%COMP%]{padding:.2rem .6rem;border-radius:12px;font-size:.75rem;font-weight:600}.type-badge.info[_ngcontent-%COMP%]{background:#1e3a5f;color:#93c5fd}.type-badge.warning[_ngcontent-%COMP%]{background:#451a03;color:#fb923c}.type-badge.maintenance[_ngcontent-%COMP%]{background:#422006;color:#fcd34d}.toggle[_ngcontent-%COMP%]{position:relative;display:inline-block;width:40px;height:22px}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{opacity:0;width:0;height:0}.slider[_ngcontent-%COMP%]{position:absolute;cursor:pointer;inset:0;background:#334155;border-radius:22px;transition:.3s}.slider[_ngcontent-%COMP%]:before{position:absolute;content:"";height:16px;width:16px;left:3px;bottom:3px;background:#f1f5f9;border-radius:50%;transition:.3s}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]{background:#10b981}.toggle[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:checked + .slider[_ngcontent-%COMP%]:before{transform:translate(18px)}.date-cell[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.btn-action[_ngcontent-%COMP%]{padding:.35rem .65rem;border-radius:6px;border:none;background:#334155;color:#94a3b8;font-size:.8rem;cursor:pointer;margin-right:.5rem}.btn-action.red[_ngcontent-%COMP%]{background:#450a0a;color:#f87171}.modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0009;display:flex;align-items:center;justify-content:center;z-index:100}.modal[_ngcontent-%COMP%]{background:#1e293b;border-radius:12px;padding:1.5rem;min-width:400px;border:1px solid #334155}.modal[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{color:#f1f5f9;margin:0 0 1rem}.form-group[_ngcontent-%COMP%]{margin-bottom:1rem}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;color:#94a3b8;font-size:.85rem;margin-bottom:.35rem}.input[_ngcontent-%COMP%]{width:100%;padding:.5rem .75rem;border-radius:8px;border:1px solid #334155;background:#0f172a;color:#f1f5f9;font-size:.9rem}.form-row[_ngcontent-%COMP%]{display:flex;gap:1rem}.form-row[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1}.modal-actions[_ngcontent-%COMP%]{display:flex;gap:.75rem;justify-content:flex-end;margin-top:1.5rem}.btn-cancel[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:8px;border:1px solid #334155;background:transparent;color:#94a3b8;cursor:pointer}.btn-save[_ngcontent-%COMP%]{padding:.5rem 1rem;border-radius:8px;border:none;background:#10b981;color:#fff;font-weight:600;cursor:pointer}.toast[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;background:#1e293b;border:1px solid #10b981;color:#10b981;padding:.75rem 1.25rem;border-radius:10px;font-size:.9rem;font-weight:600;z-index:200}']})};export{L as AnnouncementsComponent};
