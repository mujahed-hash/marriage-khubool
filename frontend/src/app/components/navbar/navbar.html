<header>
    <nav class="nav">
        <div class="nav-left">
            <button class="menu-toggle" (click)="toggleMenu()" aria-label="Toggle menu">
                <i class="fa-solid fa-bars"></i>
            </button>
            <div class="logo">
                <a routerLink="/">
                    <img loading="lazy" src="assets/logo.png" alt="Khubool Hai">
                </a>
            </div>
        </div>
        <form class="search-bar hidden-mobile" (ngSubmit)="onSearch()">
            <input type="text" [(ngModel)]="searchQuery" name="searchQuery"
                placeholder="Search by name, city, occupation...">
            <button type="submit" class="search-btn"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>
        <div class="icon-bar">
            <a routerLink="/shortlist" class="icon-link hidden-mobile" title="Shortlist"><i
                    class="fa-solid fa-heart"></i></a>
            <a routerLink="/chat" class="icon-link hidden-mobile" title="Chat"><i class="fa-solid fa-comments"></i></a>
            @if (authService.isAuthenticated()) {
            <div class="dropdown notification-dropdown">
                <a routerLink="/notifications" (click)="dropdownOpen = false" class="notification-bell"
                    title="Notifications">
                    <i class="fa-solid fa-bell"></i>
                    @if (notificationCount() > 0) {
                    <span class="notification-badge">{{ notificationCount() > 99 ? '99+' : notificationCount() }}</span>
                    }
                </a>
            </div>
            }
            <div class="dropdown" #dropdownRef>
                <div class="dropdown-backdrop" *ngIf="dropdownOpen" (click)="dropdownOpen = false"
                    (touchstart)="dropdownOpen = false"></div>
                <button type="button" class="icon-btn" (click)="toggleDropdown()"
                    (touchstart)="toggleDropdown(); $event.preventDefault(); $event.stopPropagation()" id="userButton"
                    aria-label="User menu">
                    <i class="fa-solid fa-circle-user"></i>
                </button>
                <div class="dropdown-content" [class.show]="dropdownOpen">
                    <a routerLink="/" class="nav-link" (click)="dropdownOpen = false"><i class="fa-solid fa-house"></i>
                        Homepage</a>

                    <ng-container *ngIf="authService.isAuthenticated(); else authLinks">
                        <a routerLink="/my-profile" (click)="dropdownOpen = false"><i
                                class="fa-solid fa-address-card"></i> My Profile</a>
                        <a routerLink="/profile-visitors" (click)="dropdownOpen = false"><i class="fa-solid fa-eye"></i>
                            Profile
                            visitors ({{ visitorCount }})</a>
                        <a routerLink="/membership" (click)="dropdownOpen = false"><i
                                class="fa-brands fa-web-awesome"></i> Membership</a>
                        <a routerLink="/settings" (click)="dropdownOpen = false"><i class="fa-solid fa-gear"></i>
                            Settings</a>
                        <a href="javascript:void(0)" (click)="logout()"><i class="fa-solid fa-power-off"></i> Logout</a>
                    </ng-container>

                    <ng-template #authLinks>
                        <a routerLink="/login" (click)="dropdownOpen = false"><i
                                class="fa-solid fa-right-to-bracket"></i> Login</a>
                        <a routerLink="/register" (click)="dropdownOpen = false"><i class="fa-solid fa-user-plus"></i>
                            Register</a>
                    </ng-template>
                </div>
            </div>
        </div>
    </nav>

</header>