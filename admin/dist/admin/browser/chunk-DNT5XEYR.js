import{$b as W,Ca as w,Cb as T,Eb as N,La as f,Ma as x,Oa as M,Ob as D,Pa as S,Qa as b,R as u,Ra as t,Rb as z,S as _,Sa as n,Ub as V,Vb as A,Wb as F,Xa as v,Za as g,_a as d,_b as U,aa as m,ab as h,cb as i,db as c,eb as C,fb as O,gb as I,hb as y,ib as E,kb as R,mb as k,pa as r,xa as P}from"./chunk-RU7WV6XK.js";var j=(a,o)=>o._id;function B(a,o){a&1&&(t(0,"div",8),i(1,"Loading reports..."),n())}function L(a,o){if(a&1){let e=v();t(0,"div",23)(1,"button",24),g("click",function(){u(e);let s=d().$implicit,p=d(2);return _(p.resolve(s))}),i(2,"\u2713 Resolve"),n(),t(3,"button",25),g("click",function(){u(e);let s=d().$implicit,p=d(2);return _(p.dismiss(s))}),i(4,"\u2715 Dismiss"),n(),t(5,"button",26),g("click",function(){u(e);let s=d().$implicit,p=d(2);return _(p.suspendReported(s))}),i(6,"\u{1F512}"),n()()}}function Y(a,o){if(a&1&&(t(0,"tr")(1,"td")(2,"div",16)(3,"div",17),i(4),n(),t(5,"div")(6,"div",18),i(7),n(),t(8,"div",19),i(9),n()()()(),t(10,"td")(11,"div",16)(12,"div",17),i(13),n(),t(14,"div")(15,"div",18),i(16),n(),t(17,"div",19),i(18),n()()()(),t(19,"td",20),i(20),n(),t(21,"td",21),i(22),R(23,"date"),n(),t(24,"td")(25,"span",22),i(26),n()(),t(27,"td"),f(28,L,7,0,"div",23),n()()),a&2){let e=o.$implicit;h("row-pending",!e.status||e.status==="pending")("row-resolved",e.status==="resolved")("row-dismissed",e.status==="dismissed"),r(4),c((e.reporterId==null||e.reporterId.fullName==null?null:e.reporterId.fullName.charAt(0))||"?"),r(3),c((e.reporterId==null?null:e.reporterId.fullName)||"\u2014"),r(2),c(e.reporterId==null?null:e.reporterId.email),r(4),c((e.reportedProfileId==null||e.reportedProfileId.fullName==null?null:e.reportedProfileId.fullName.charAt(0))||"?"),r(3),c((e.reportedProfileId==null?null:e.reportedProfileId.fullName)||"\u2014"),r(2),C("ID: ",(e.reportedProfileId==null?null:e.reportedProfileId.profileId)||"\u2014"),r(2),c(e.reason||"\u2014"),r(2),c(k(23,22,e.createdAt,"medium")),r(3),h("pending",!e.status||e.status==="pending")("resolved",e.status==="resolved")("dismissed",e.status==="dismissed"),r(),C(" ",e.status||"pending"," "),r(2),x(!e.status||e.status==="pending"?28:-1)}}function q(a,o){a&1&&(t(0,"tr")(1,"td",27),i(2,"No reports found."),n()())}function G(a,o){if(a&1){let e=v();t(0,"table",10)(1,"thead")(2,"tr")(3,"th"),i(4,"Reporter"),n(),t(5,"th"),i(6,"Reported Profile"),n(),t(7,"th"),i(8,"Reason"),n(),t(9,"th"),i(10,"Date"),n(),t(11,"th"),i(12,"Status"),n(),t(13,"th"),i(14,"Actions"),n()()(),t(15,"tbody"),M(16,Y,29,25,"tr",11,j,!1,q,3,0,"tr"),n()(),t(19,"div",12)(20,"button",13),g("click",function(){u(e);let s=d();return _(s.prevPage())}),i(21,"\u2190 Prev"),n(),t(22,"span",14),i(23),n(),t(24,"button",13),g("click",function(){u(e);let s=d();return _(s.nextPage())}),i(25,"Next \u2192"),n(),t(26,"span",15),i(27),n()()}if(a&2){let e=d();r(16),S(e.reports()),r(4),b("disabled",e.page()<=1),r(3),O("Page ",e.page()," of ",e.pages()),r(),b("disabled",e.page()>=e.pages()),r(3),C("",e.total()," total")}}function H(a,o){if(a&1&&(t(0,"div",9),i(1),n()),a&2){let e=d();r(),c(e.toast())}}var $=class a{constructor(o){this.api=o}reports=m([]);loading=m(!0);page=m(1);pages=m(1);total=m(0);filterStatus="";toast=m("");ngOnInit(){this.load()}async load(){this.loading.set(!0);try{let o={page:this.page(),limit:20};this.filterStatus&&(o.status=this.filterStatus);let e=await this.api.getReports(o);this.reports.set(e.reports),this.total.set(e.total),this.pages.set(e.pages)}catch{}this.loading.set(!1)}prevPage(){this.page.update(o=>Math.max(1,o-1)),this.load()}nextPage(){this.page.update(o=>o+1),this.load()}async resolve(o){await this.api.resolveReport(o._id),o.status="resolved",this.showToast("Report resolved. User notified.")}async dismiss(o){await this.api.dismissReport(o._id),o.status="dismissed",this.showToast("Report dismissed.")}async suspendReported(o){let e=o.reportedProfileId,l=e?.userId?._id??e?.userId;if(!l){this.showToast("Could not find user.");return}await this.api.suspendUser(String(l)),await this.resolve(o),this.showToast("User suspended and report resolved.")}showToast(o){this.toast.set(o),setTimeout(()=>this.toast.set(""),3e3)}static \u0275fac=function(e){return new(e||a)(P(W))};static \u0275cmp=w({type:a,selectors:[["app-reports"]],decls:15,vars:3,consts:[[1,"reports-page"],[1,"filters"],[1,"select-filter",3,"ngModelChange","ngModel"],["value",""],["value","pending"],["value","resolved"],["value","dismissed"],[1,"table-card"],[1,"loading"],[1,"toast"],[1,"admin-table"],[3,"row-pending","row-resolved","row-dismissed"],[1,"pagination"],[1,"btn-page",3,"click","disabled"],[1,"page-info"],[1,"total-info"],[1,"user-cell"],[1,"user-avatar"],[1,"user-name"],[1,"user-email"],[1,"reason-cell"],[1,"date-cell"],[1,"status-badge"],[1,"action-row"],["title","Resolve (warn user)",1,"btn-action","green",3,"click"],["title","Dismiss",1,"btn-action","warn",3,"click"],["title","Suspend reported user",1,"btn-action","red",3,"click"],["colspan","6",1,"empty-row"]],template:function(e,l){e&1&&(t(0,"div",0)(1,"div",1)(2,"select",2),E("ngModelChange",function(p){return y(l.filterStatus,p)||(l.filterStatus=p),p}),g("ngModelChange",function(){return l.load()}),t(3,"option",3),i(4,"Pending only"),n(),t(5,"option",4),i(6,"Pending"),n(),t(7,"option",5),i(8,"Resolved"),n(),t(9,"option",6),i(10,"Dismissed"),n()()(),t(11,"div",7),f(12,B,2,0,"div",8)(13,G,28,6),n(),f(14,H,2,1,"div",9),n()),e&2&&(r(2),I("ngModel",l.filterStatus),r(10),x(l.loading()?12:13),r(2),x(l.toast()?14:-1))},dependencies:[N,U,A,F,V,D,z,T],styles:[".reports-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.filters[_ngcontent-%COMP%]{display:flex;gap:.75rem}.select-filter[_ngcontent-%COMP%]{padding:.6rem .9rem;border-radius:8px;border:1px solid #334155;background:#1e293b;color:#f1f5f9;font-size:.9rem;outline:none}.select-filter[_ngcontent-%COMP%]:focus{border-color:#6366f1}.table-card[_ngcontent-%COMP%]{background:#1e293b;border-radius:12px;border:1px solid #334155;overflow:hidden}.loading[_ngcontent-%COMP%], .empty-row[_ngcontent-%COMP%]{color:#94a3b8;text-align:center;padding:3rem}.admin-table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#0f172a}th[_ngcontent-%COMP%]{color:#64748b;font-size:.75rem;text-transform:uppercase;letter-spacing:.5px;padding:.75rem 1rem;text-align:left}td[_ngcontent-%COMP%]{padding:.85rem 1rem;border-top:1px solid #334155;color:#f1f5f9;font-size:.9rem;vertical-align:middle}.row-pending[_ngcontent-%COMP%]{border-left:4px solid #ef4444}.row-resolved[_ngcontent-%COMP%]{border-left:4px solid #10b981;opacity:.8}.row-dismissed[_ngcontent-%COMP%]{border-left:4px solid #64748b;opacity:.7}.user-cell[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem}.user-avatar[_ngcontent-%COMP%]{width:36px;height:36px;border-radius:50%;background:#6366f1;color:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:.9rem;flex-shrink:0}.user-name[_ngcontent-%COMP%]{font-weight:600;color:#f1f5f9;font-size:.9rem}.user-email[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.reason-cell[_ngcontent-%COMP%]{max-width:200px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.date-cell[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem}.status-badge[_ngcontent-%COMP%]{padding:.2rem .6rem;border-radius:12px;font-size:.75rem;font-weight:600}.status-badge.pending[_ngcontent-%COMP%]{background:#450a0a;color:#f87171}.status-badge.resolved[_ngcontent-%COMP%]{background:#052e16;color:#4ade80}.status-badge.dismissed[_ngcontent-%COMP%]{background:#1e293b;color:#94a3b8}.action-row[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.btn-action[_ngcontent-%COMP%]{padding:.4rem .75rem;border-radius:6px;border:none;cursor:pointer;font-size:.8rem;font-weight:600;transition:all .2s}.btn-action.green[_ngcontent-%COMP%]{background:#064e3b;color:#4ade80}.btn-action.warn[_ngcontent-%COMP%]{background:#451a03;color:#fb923c}.btn-action.red[_ngcontent-%COMP%]{background:#450a0a;color:#f87171}.btn-action[_ngcontent-%COMP%]:hover{transform:translateY(-1px)}.pagination[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;padding:1rem 1.25rem;border-top:1px solid #334155}.btn-page[_ngcontent-%COMP%]{padding:.4rem .9rem;border-radius:6px;border:1px solid #334155;background:#0f172a;color:#94a3b8;font-size:.85rem;cursor:pointer}.btn-page[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.page-info[_ngcontent-%COMP%]{color:#94a3b8;font-size:.85rem}.total-info[_ngcontent-%COMP%]{color:#64748b;font-size:.8rem;margin-left:auto}.toast[_ngcontent-%COMP%]{position:fixed;bottom:2rem;right:2rem;background:#1e293b;border:1px solid #10b981;color:#10b981;padding:.75rem 1.25rem;border-radius:10px;font-size:.9rem;font-weight:600;z-index:200}"]})};export{$ as ReportsComponent};
