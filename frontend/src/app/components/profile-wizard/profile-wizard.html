<div class="create-profile">
    <div class="instructions">
        <h1>{{ isEditMode() ? 'Edit Your Profile' : 'Profile Creation' }}</h1>
        <p>1. Fill Out the Details: Enter your information in the fields provided. You can add as much or as little
            information as you prefer.</p>
        <p>2. Leave Fields Blank: If you don't wish to update a particular field, you can leave it empty.</p>
        <p>3. Photo Privacy: You can choose to make your photo visible or share it upon request. Manage this setting on
            the My Profile page as needed.</p>
        <button type="button" class="fill-test-btn" (click)="loadDummyData()"><i class="fa-solid fa-flask"></i> Fill
            with test data</button>
    </div>
    <div class="creating-pro-section">
        <div class="wizard-container" [class.completed]="isCompleted()">
            <!-- Success View -->
            <div *ngIf="isCompleted()" class="success-view animate-in">
                <div class="success-card">
                    <div class="success-icon">
                        <i class="fa-solid fa-circle-check"></i>
                    </div>
                    <h2>Profile Complete!</h2>
                    <p>Your profile is now live. We're searching for your perfect match...</p>
                    <div class="matching-loader">
                        <div class="pulse-ring"></div>
                        <img loading="lazy" [src]="imagePreview() || 'assets/groom.png'" class="user-preview">
                    </div>
                    <p class="redirect-hint">Redirecting to dashboard...</p>
                </div>
            </div>

            <div *ngIf="!isCompleted()" class="wizard-card tier-glow">
                <!-- Clickable Stepper -->
                <div class="wizard-stepper">
                    @for (s of stepLabels; track s.num) {
                    <div class="stepper-step" [class.active]="currentStep() === s.num"
                        [class.completed]="currentStep() > s.num" (click)="goToStep(s.num)">
                        <div class="stepper-circle">
                            <i class="fa-solid" [ngClass]="currentStep() > s.num ? 'fa-check' : s.icon"></i>
                        </div>
                        <span class="stepper-label">{{ s.title }}</span>
                    </div>
                    @if (s.num < 8) { <div class="stepper-line" [class.filled]="currentStep() > s.num">
                </div>
                }
                }
            </div>

            <div class="wizard-progress">
                <div class="steps-info">
                    <span class="step-badge">Step {{ currentStep() }} of 8</span>
                    <span class="step-title">{{ getStepTitle() }}</span>
                </div>
                <div class="strength-meter">
                    <div class="strength-label">Profile Strength: {{ profileStrength() }}%</div>
                    <div class="strength-track">
                        <div class="strength-fill" [style.width.%]="profileStrength()"
                            [class.strong]="profileStrength() > 70"></div>
                    </div>
                </div>
            </div>

            <!-- Form Steps -->
            <form #profileForm="ngForm" class="wizard-form">

                <!-- Step 1: Basic Details -->
                <div *ngIf="currentStep() === 1" class="step-content animate-in">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" [(ngModel)]="profileData().fullName" name="fullName" required
                                class="custom-input" placeholder="Enter full name">
                        </div>
                        <div class="form-group">
                            <label>Gender</label>
                            <select [(ngModel)]="profileData().gender" name="gender" required class="custom-input">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Date of Birth</label>
                            <input type="date" [(ngModel)]="profileData().dateOfBirth" name="dateOfBirth" required
                                class="custom-input">
                        </div>
                        <div class="form-group">
                            <label>Height (cm)</label>
                            <input type="number" [(ngModel)]="profileData().height" name="height" required
                                class="custom-input" placeholder="e.g. 175">
                        </div>
                        <div class="form-group">
                            <label>Mother Tongue</label>
                            <input type="text" [(ngModel)]="profileData().motherTongue" name="motherTongue" required
                                class="custom-input" placeholder="e.g. Hindi, Bengali">
                        </div>
                        <div class="form-group">
                            <label>Marital Status</label>
                            <select [(ngModel)]="profileData().maritalStatus" name="maritalStatus" required
                                class="custom-input">
                                <option value="">Select Status</option>
                                <option value="never_married">Never Married</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                                <option value="awaiting_divorce">Awaiting Divorce</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Religious & Cultural -->
                <div *ngIf="currentStep() === 2" class="step-content animate-in">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Religion</label>
                            <select [(ngModel)]="profileData().religion" name="religion" required class="custom-input">
                                <option value="">Select Religion</option>
                                <option value="hindu">Hindu</option>
                                <option value="muslim">Muslim</option>
                                <option value="sikh">Sikh</option>
                                <option value="christian">Christian</option>
                                <option value="jain">Jain</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Caste / Sect</label>
                            <input type="text" [(ngModel)]="profileData().caste" name="caste" required
                                class="custom-input" placeholder="Enter caste/sect">
                        </div>
                        <div class="form-group">
                            <label>Gothra (Optional)</label>
                            <input type="text" [(ngModel)]="profileData().gothra" name="gothra" class="custom-input"
                                placeholder="Enter gothra">
                        </div>
                        <div class="form-group">
                            <label>Manglik Status</label>
                            <select [(ngModel)]="profileData().manglik" name="manglik" required class="custom-input">
                                <option value="">Select</option>
                                <option value="yes">Manglik</option>
                                <option value="no">Non-Manglik</option>
                                <option value="dont_know">Don't Know</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Location Details -->
                <div *ngIf="currentStep() === 3" class="step-content animate-in">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Country</label>
                            <input type="text" [(ngModel)]="profileData().country" name="country" required
                                class="custom-input" placeholder="India">
                        </div>
                        <div class="form-group">
                            <label>State</label>
                            <select [(ngModel)]="profileData().state" name="state" required class="custom-input"
                                (change)="onStateChange()">
                                <option value="">Select State</option>
                                <option *ngFor="let state of states" [value]="state">{{ stateLabels[state] || state
                                    }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>District</label>
                            <select [(ngModel)]="profileData().district" name="district" required class="custom-input">
                                <option value="">Select District</option>
                                <option *ngFor="let district of districts" [value]="district">{{ district }}
                                </option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>City / Town</label>
                            <input type="text" [(ngModel)]="profileData().city" name="city" required
                                class="custom-input" placeholder="Enter city">
                        </div>
                    </div>
                </div>

                <!-- Step 4: Education & Career -->
                <div *ngIf="currentStep() === 4" class="step-content animate-in">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Highest Education</label>
                            <select [(ngModel)]="profileData().highestEducation" name="highestEducation" required
                                class="custom-input">
                                <option value="">Select Education</option>
                                <option value="doctorate">Doctorate</option>
                                <option value="masters">Masters</option>
                                <option value="bachelors">Bachelors</option>
                                <option value="diploma">Diploma</option>
                                <option value="high_school">High School</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Occupation</label>
                            <input type="text" [(ngModel)]="profileData().occupation" name="occupation" required
                                class="custom-input" placeholder="e.g. Software Engineer">
                        </div>
                        <div class="form-group">
                            <label>Monthly Income</label>
                            <select [(ngModel)]="profileData().monthlyIncome" name="monthlyIncome" class="custom-input">
                                <option value="">Select Monthly Income</option>
                                <option value="0-25k">0 - 25k</option>
                                <option value="25k-50k">25k - 50k</option>
                                <option value="50k-1L">50k - 1L</option>
                                <option value="1L-2L">1L - 2L</option>
                                <option value="2L+">2L+</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Family Details -->
                <div *ngIf="currentStep() === 5" class="step-content animate-in">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Father's Status</label>
                            <input type="text" [(ngModel)]="profileData().fatherStatus" name="fatherStatus" required
                                class="custom-input" placeholder="e.g. Retired Engineer">
                        </div>
                        <div class="form-group">
                            <label>Mother's Status</label>
                            <input type="text" [(ngModel)]="profileData().motherStatus" name="motherStatus" required
                                class="custom-input" placeholder="e.g. Homemaker">
                        </div>
                        <div class="form-group">
                            <label>Siblings</label>
                            <input type="text" [(ngModel)]="profileData().siblings" name="siblings" required
                                class="custom-input" placeholder="e.g. 1 brother, 1 sister">
                        </div>
                        <div class="form-group">
                            <label>Family Type</label>
                            <select [(ngModel)]="profileData().familyType" name="familyType" required
                                class="custom-input">
                                <option value="">Select Family Type</option>
                                <option value="nuclear">Nuclear</option>
                                <option value="joint">Joint</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Family Values</label>
                            <select [(ngModel)]="profileData().familyValues" name="familyValues" required
                                class="custom-input">
                                <option value="">Select Values</option>
                                <option value="traditional">Traditional</option>
                                <option value="moderate">Moderate</option>
                                <option value="liberal">Liberal</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 6: Lifestyle & Interests -->
                <div *ngIf="currentStep() === 6" class="step-content animate-in">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Diet</label>
                            <select [(ngModel)]="profileData().diet" name="diet" required class="custom-input">
                                <option value="">Select Diet</option>
                                <option value="veg">Vegetarian</option>
                                <option value="non_veg">Non-Vegetarian</option>
                                <option value="eggetarian">Eggetarian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Smoking</label>
                            <select [(ngModel)]="profileData().smoking" name="smoking" required class="custom-input">
                                <option value="no">Non-smoker</option>
                                <option value="occasionally">Occasionally</option>
                                <option value="regularly">Regularly</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Drinking</label>
                            <select [(ngModel)]="profileData().drinking" name="drinking" required class="custom-input">
                                <option value="no">Non-drinker</option>
                                <option value="occasionally">Occasionally</option>
                                <option value="regularly">Regularly</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>Hobbies / Interests</label>
                            <input type="text" [(ngModel)]="hobbiesString" name="hobbies" required class="custom-input"
                                placeholder="e.g. Traveling, Reading, Music (comma separated)">
                        </div>
                        <div class="form-group full-width">
                            <label>About Me (Bio)</label>
                            <textarea [(ngModel)]="profileData().bio" name="bio" required class="custom-input" rows="4"
                                placeholder="Tell us about yourself..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- Step 7: Media -->
                <div *ngIf="currentStep() === 7" class="step-content animate-in">
                    <div class="upload-area" (click)="fileInput.click()" [class.has-image]="imagePreview()">
                        <input type="file" #fileInput class="hidden-input" (change)="onFileSelected($event)"
                            accept="image/*">

                        <ng-container *ngIf="!imagePreview()">
                            <i class="fa-solid fa-cloud-arrow-up"></i>
                            <h3>Upload Profile Photo</h3>
                            <p>Show your best self! Clear photos get 5x more matches.</p>
                            <button type="button" class="tier-bg upload-btn">Choose Photo</button>
                        </ng-container>

                        <ng-container *ngIf="imagePreview()">
                            <div class="preview-container">
                                <img loading="lazy" [src]="imagePreview()" class="image-preview">
                                <div class="preview-overlay">
                                    <i class="fa-solid fa-camera-rotate"></i>
                                    <span>Change Photo</span>
                                </div>
                            </div>
                        </ng-container>
                    </div>

                    <div class="upload-tips" *ngIf="currentStep() === 7">
                        <h4>ðŸ’¡ Photo Tips</h4>
                        <ul>
                            <li>Use a clear, high-quality headshot</li>
                            <li>Avoid filters or group photos</li>
                            <li>Smile and be yourself!</li>
                        </ul>
                    </div>
                </div>

                <!-- Step 8: Partner Preferences -->
                <div *ngIf="currentStep() === 8" class="step-content animate-in">
                    <div class="form-grid" *ngIf="profileData().partnerPreferences">
                        <div class="form-group">
                            <label>Preferred Age Min</label>
                            <input type="number" [(ngModel)]="profileData().partnerPreferences!.ageRange!.min"
                                name="prefAgeMin" class="custom-input" placeholder="e.g. 25">
                        </div>
                        <div class="form-group">
                            <label>Preferred Age Max</label>
                            <input type="number" [(ngModel)]="profileData().partnerPreferences!.ageRange!.max"
                                name="prefAgeMax" class="custom-input" placeholder="e.g. 30">
                        </div>
                        <div class="form-group full-width">
                            <label>Acceptable Marital Status (Hold Ctrl/Cmd to select multiple)</label>
                            <select [(ngModel)]="profileData().partnerPreferences!.maritalStatus"
                                name="prefMaritalStatus" class="custom-input" multiple size="3">
                                <option value="never_married">Never Married</option>
                                <option value="divorced">Divorced</option>
                                <option value="widowed">Widowed</option>
                                <option value="awaiting_divorce">Awaiting Divorce</option>
                            </select>
                        </div>
                        <div class="form-group full-width">
                            <label>Preferred Diet</label>
                            <select [(ngModel)]="profileData().partnerPreferences!.diet" name="prefDiet"
                                class="custom-input" multiple size="3">
                                <option value="veg">Vegetarian</option>
                                <option value="non_veg">Non-Vegetarian</option>
                                <option value="eggetarian">Eggetarian</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Preferred Religion</label>
                            <input type="text" [(ngModel)]="profileData().partnerPreferences!.religion"
                                name="prefReligion" class="custom-input" placeholder="e.g. Hindu, Muslim">
                        </div>
                        <div class="form-group">
                            <label>Preferred Income</label>
                            <input type="text" [(ngModel)]="profileData().partnerPreferences!.annualIncome"
                                name="prefIncome" class="custom-input" placeholder="e.g. 50k - 1L">
                        </div>
                    </div>
                </div>

                <!-- Wizard Actions -->
                <div class="wizard-actions">
                    <button type="button" class="btn-secondary" (click)="prev()" [disabled]="isSaving()">
                        <i class="fa-solid" [ngClass]="currentStep() === 1 ? 'fa-home' : 'fa-arrow-left'"></i>
                        {{ currentStep() === 1 ? 'Home' : 'Previous' }}
                    </button>

                    <button type="button" class="btn-save-progress" (click)="saveProgress()" [disabled]="isSaving()">
                        <i class="fa-solid" [ngClass]="isSaving() ? 'fa-spinner fa-spin' : 'fa-floppy-disk'"></i>
                        {{ isSaving() ? 'Saving...' : 'Save Progress' }}
                    </button>

                    <button *ngIf="currentStep() < 8" type="button" class="tier-bg btn-primary" (click)="next()">
                        Next <i class="fa-solid fa-arrow-right"></i>
                    </button>

                    <button *ngIf="currentStep() === 8" type="button" class="tier-bg btn-primary" (click)="finish()"
                        [disabled]="isSaving()">
                        <span *ngIf="!isSaving()">Finish <i class="fa-solid fa-check"></i></span>
                        <span *ngIf="isSaving()">Saving... <i class="fa-solid fa-spinner fa-spin"></i></span>
                    </button>
                </div>

                @if (saveMessage()) {
                <div class="save-toast" [class.error]="saveMessage().includes('Failed')">{{ saveMessage() }}</div>
                }
            </form>
        </div>
    </div>
</div>
</div>